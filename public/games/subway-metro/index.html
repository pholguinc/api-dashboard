<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Metro Surfers Lima - Corre por las estaciones del Metro de Lima</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        
        #gameContainer {
            width: 95vw;
            height: 75vh;
            max-width: 800px;
            max-height: 600px;
            background: linear-gradient(180deg, #87CEEB 0%, #98FB98 100%);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }
        
        #gameTitle {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 100;
        }
        
        #score {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 100;
        }
        
        #player {
            width: 40px;
            height: 60px;
            background: #ff6b35;
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            z-index: 50;
            transition: all 0.2s ease;
        }
        
        .obstacle {
            width: 50px;
            height: 80px;
            background: #8B4513;
            position: absolute;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .coin {
            width: 25px;
            height: 25px;
            background: #FFD700;
            position: absolute;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            z-index: 40;
        }
        
        #gameOverScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 200;
        }
        
        #gameOverScreen h2 {
            color: white;
            font-size: 36px;
            margin-bottom: 20px;
        }
        
        #gameOverScreen p {
            color: white;
            font-size: 18px;
            margin-bottom: 30px;
        }
        
        #restartBtn {
            padding: 15px 30px;
            font-size: 18px;
            background: #ff6b35;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        #restartBtn:hover {
            background: #e55a2b;
        }
        
        #instructions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            text-align: center;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            z-index: 100;
        }
        
        .control-hint {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            text-align: center;
            font-size: 12px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            z-index: 100;
        }
        
        /* On-screen controls for mobile */
        .mobile-controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-between;
            z-index: 150;
        }
        
        .control-btn {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 50%;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }
        
        .control-btn:active {
            transform: scale(0.9);
            background: rgba(255, 255, 255, 1);
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="gameTitle">ðŸš‡ Metro Surfers Lima</div>
        <div id="score">Puntos: 0 | Monedas: 0</div>
        
        <div id="player"></div>
        
        <div id="instructions">
            Esquiva los obstÃ¡culos y recoge monedas
        </div>
        
        <div class="control-hint">
            ðŸ‘ˆðŸ‘‰ Desliza o usa flechas para moverte | ðŸ‘† Saltar | ðŸ‘‡ Agacharse
        </div>
        
        <div class="mobile-controls">
            <button class="control-btn" id="leftBtn">ðŸ‘ˆ</button>
            <button class="control-btn" id="jumpBtn">ðŸ‘†</button>
            <button class="control-btn" id="duckBtn">ðŸ‘‡</button>
            <button class="control-btn" id="rightBtn">ðŸ‘‰</button>
        </div>
        
        <div id="gameOverScreen">
            <h2 id="gameOverTitle">Â¡PERDISTE!</h2>
            <p id="gameOverStats">PuntuaciÃ³n: 0 | Monedas: 0</p>
            <button id="restartBtn">ðŸ”„ Jugar de Nuevo</button>
        </div>
    </div>

    <script>
        // TelemetroAPI Integration
        window.TelemetroAPI = {
            onGameStart: function(gameData) {
                console.log('ðŸŽ® Metro Surfers iniciado:', gameData);
                if (window.ReactNativeWebView) {
                    window.ReactNativeWebView.postMessage(JSON.stringify({
                        type: 'gameStart',
                        game: 'metro-surfers',
                        data: gameData
                    }));
                }
            },
            onCoinCollected: function(coins, totalCoins) {
                console.log('ðŸª™ Moneda recolectada:', coins, 'total:', totalCoins);
                const points = Math.floor(totalCoins / 5) * 2; // 2 puntos cada 5 monedas
                if (window.ReactNativeWebView) {
                    window.ReactNativeWebView.postMessage(JSON.stringify({
                        type: 'coinCollected',
                        game: 'metro-surfers',
                        coins: totalCoins,
                        points: points
                    }));
                }
            },
            onDistanceReached: function(distance) {
                console.log('ðŸƒ Distancia alcanzada:', distance + 'm');
                const points = Math.floor(distance / 50) * 3; // 3 puntos cada 50 metros
                if (window.ReactNativeWebView) {
                    window.ReactNativeWebView.postMessage(JSON.stringify({
                        type: 'distanceReached',
                        game: 'metro-surfers',
                        distance: distance,
                        points: points
                    }));
                }
            },
            onGameOver: function(finalScore, coins, distance) {
                console.log('ðŸ’€ Juego terminado - Puntos:', finalScore, 'Monedas:', coins, 'Distancia:', distance);
                const totalPoints = Math.floor(finalScore / 50) + Math.floor(coins / 2);
                if (window.ReactNativeWebView) {
                    window.ReactNativeWebView.postMessage(JSON.stringify({
                        type: 'gameOver',
                        game: 'metro-surfers',
                        finalScore: finalScore,
                        coins: coins,
                        distance: distance,
                        points: totalPoints
                    }));
                }
            }
        };

        // Game variables
        let gameRunning = false;
        let score = 0;
        let coins = 0;
        let distance = 0;
        let playerLane = 1; // 0=left, 1=center, 2=right
        let playerY = 100; // from bottom
        let isJumping = false;
        let isDucking = false;
        let gameSpeed = 2;
        let obstacles = [];
        let gameCoins = [];
        let gameContainer = document.getElementById('gameContainer');
        let player = document.getElementById('player');
        let lastDistanceReport = 0;

        // Game initialization
        function initGame() {
            gameRunning = true;
            score = 0;
            coins = 0;
            distance = 0;
            playerLane = 1;
            playerY = 100;
            isJumping = false;
            isDucking = false;
            gameSpeed = 2;
            obstacles = [];
            gameCoins = [];
            lastDistanceReport = 0;
            
            updatePlayerPosition();
            updateScore();
            
            // Clear existing obstacles and coins
            document.querySelectorAll('.obstacle').forEach(el => el.remove());
            document.querySelectorAll('.coin').forEach(el => el.remove());
            
            // Hide game over screen
            document.getElementById('gameOverScreen').style.display = 'none';
            
            // Start game loop
            gameLoop();
            
            // Trigger game start
            window.TelemetroAPI.onGameStart({
                gameId: 'metro-surfers',
                timestamp: new Date().toISOString()
            });
        }

        function updatePlayerPosition() {
            const lanes = [25, 50, 75]; // percentage from left
            player.style.left = lanes[playerLane] + '%';
            player.style.bottom = playerY + 'px';
            
            // Visual feedback for ducking
            if (isDucking) {
                player.style.height = '40px';
                player.style.borderRadius = '20px';
            } else {
                player.style.height = '60px';
                player.style.borderRadius = '10px';
            }
        }

        function updateScore() {
            document.getElementById('score').textContent = `Puntos: ${score} | Monedas: ${coins}`;
        }

        function moveLeft() {
            if (playerLane > 0) {
                playerLane--;
                updatePlayerPosition();
            }
        }

        function moveRight() {
            if (playerLane < 2) {
                playerLane++;
                updatePlayerPosition();
            }
        }

        function jump() {
            if (!isJumping && !isDucking) {
                isJumping = true;
                playerY = 200;
                updatePlayerPosition();
                
                setTimeout(() => {
                    playerY = 100;
                    isJumping = false;
                    updatePlayerPosition();
                }, 600);
            }
        }

        function duck() {
            if (!isJumping && !isDucking) {
                isDucking = true;
                updatePlayerPosition();
                
                setTimeout(() => {
                    isDucking = false;
                    updatePlayerPosition();
                }, 400);
            }
        }

        function spawnObstacle() {
            if (!gameRunning) return;
            
            const obstacle = document.createElement('div');
            obstacle.className = 'obstacle';
            
            const lane = Math.floor(Math.random() * 3);
            const lanes = [25, 50, 75];
            
            obstacle.style.left = lanes[lane] + '%';
            obstacle.style.top = '-80px';
            obstacle.style.transform = 'translateX(-50%)';
            
            gameContainer.appendChild(obstacle);
            obstacles.push({
                element: obstacle,
                lane: lane,
                y: -80
            });
        }

        function spawnCoin() {
            if (!gameRunning) return;
            
            const coin = document.createElement('div');
            coin.className = 'coin';
            
            const lane = Math.floor(Math.random() * 3);
            const lanes = [25, 50, 75];
            
            coin.style.left = lanes[lane] + '%';
            coin.style.top = Math.random() * 200 + 50 + 'px';
            coin.style.transform = 'translateX(-50%)';
            
            gameContainer.appendChild(coin);
            gameCoins.push({
                element: coin,
                lane: lane,
                y: parseInt(coin.style.top)
            });
        }

        function checkCollisions() {
            const containerHeight = gameContainer.offsetHeight;
            
            // Check obstacle collisions
            obstacles.forEach((obstacle, index) => {
                if (obstacle.lane === playerLane) {
                    const obstacleBottom = containerHeight - obstacle.y - 80;
                    const playerBottom = playerY;
                    
                    if (obstacleBottom <= playerBottom + 60 && obstacleBottom >= playerBottom - 20) {
                        if (!isDucking && !isJumping) {
                            gameOver();
                            return;
                        }
                    }
                }
            });
            
            // Check coin collisions
            gameCoins.forEach((coin, index) => {
                if (coin.lane === playerLane) {
                    const coinBottom = containerHeight - coin.y - 25;
                    const playerBottom = playerY;
                    
                    if (Math.abs(coinBottom - playerBottom - 30) < 40) {
                        // Collect coin
                        coins++;
                        score += 10;
                        coin.element.remove();
                        gameCoins.splice(index, 1);
                        updateScore();
                        
                        // Trigger coin collection
                        window.TelemetroAPI.onCoinCollected(1, coins);
                    }
                }
            });
        }

        function gameLoop() {
            if (!gameRunning) return;
            
            // Update game state
            score += 1;
            distance += gameSpeed;
            
            // Increase speed gradually
            gameSpeed += 0.001;
            
            // Move obstacles
            obstacles.forEach((obstacle, index) => {
                obstacle.y += gameSpeed * 2;
                obstacle.element.style.top = obstacle.y + 'px';
                
                // Remove obstacles that are off screen
                if (obstacle.y > gameContainer.offsetHeight) {
                    obstacle.element.remove();
                    obstacles.splice(index, 1);
                }
            });
            
            // Move coins
            gameCoins.forEach((coin, index) => {
                coin.y += gameSpeed * 2;
                coin.element.style.top = coin.y + 'px';
                
                // Remove coins that are off screen
                if (coin.y > gameContainer.offsetHeight) {
                    coin.element.remove();
                    gameCoins.splice(index, 1);
                }
            });
            
            // Spawn new obstacles and coins
            if (Math.random() < 0.02) spawnObstacle();
            if (Math.random() < 0.015) spawnCoin();
            
            // Check for distance milestones
            if (distance - lastDistanceReport >= 50) {
                lastDistanceReport = Math.floor(distance / 50) * 50;
                window.TelemetroAPI.onDistanceReached(lastDistanceReport);
            }
            
            checkCollisions();
            updateScore();
            
            requestAnimationFrame(gameLoop);
        }

        function gameOver() {
            gameRunning = false;
            
            // Show game over screen
            document.getElementById('gameOverTitle').textContent = score > 1000 ? 'Â¡INCREÃBLE!' : 'Â¡PERDISTE!';
            document.getElementById('gameOverStats').textContent = `PuntuaciÃ³n: ${score} | Monedas: ${coins} | Distancia: ${Math.floor(distance)}m`;
            document.getElementById('gameOverScreen').style.display = 'flex';
            
            // Trigger game over
            window.TelemetroAPI.onGameOver(score, coins, Math.floor(distance));
        }

        // Event listeners
        document.addEventListener('keydown', function(e) {
            switch(e.key) {
                case 'ArrowLeft':
                    e.preventDefault();
                    moveLeft();
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    moveRight();
                    break;
                case 'ArrowUp':
                case ' ':
                    e.preventDefault();
                    jump();
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    duck();
                    break;
            }
        });

        // Mobile controls
        document.getElementById('leftBtn').addEventListener('click', moveLeft);
        document.getElementById('rightBtn').addEventListener('click', moveRight);
        document.getElementById('jumpBtn').addEventListener('click', jump);
        document.getElementById('duckBtn').addEventListener('click', duck);

        // Touch controls
        let startX = 0;
        let startY = 0;

        gameContainer.addEventListener('touchstart', function(e) {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        });

        gameContainer.addEventListener('touchend', function(e) {
            if (!startX || !startY) return;
            
            const endX = e.changedTouches[0].clientX;
            const endY = e.changedTouches[0].clientY;
            
            const diffX = startX - endX;
            const diffY = startY - endY;
            
            // Determine swipe direction
            if (Math.abs(diffX) > Math.abs(diffY)) {
                // Horizontal swipe
                if (Math.abs(diffX) > 30) {
                    if (diffX > 0) {
                        moveLeft();
                    } else {
                        moveRight();
                    }
                }
            } else {
                // Vertical swipe
                if (Math.abs(diffY) > 30) {
                    if (diffY > 0) {
                        jump();
                    } else {
                        duck();
                    }
                }
            }
            
            startX = 0;
            startY = 0;
        });

        // Restart button
        document.getElementById('restartBtn').addEventListener('click', initGame);

        // Start the game
        initGame();
    </script>
</body>
</html>
